<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Menu - Bean and Brew</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/menu.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- Animated Background Elements -->
    <div class="background-animation">
        <div class="coffee-bean bean-1"></div>
        <div class="coffee-bean bean-2"></div>
        <div class="coffee-bean bean-3"></div>
        <div class="coffee-bean bean-4"></div>
        <div class="coffee-bean bean-5"></div>
        <div class="steam steam-1"></div>
        <div class="steam steam-2"></div>
        <div class="steam steam-3"></div>
    </div>

    <!-- Navigation -->
    <%- include('../partials/navbar', { page: 'menu' }) %>

    <!-- Hero Section -->
    <section class="hero hero-menu">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Our Menu</h1>
            <div class="hero-accent"></div>
            <p>Crafted with passion, served with love - discover your perfect brew</p>
        </div>
        <div class="hero-scroll-indicator">
            <i class="fas fa-chevron-down"></i>
        </div>
    </section>

    <!-- Menu Section -->
    <section class="menu">
        <div class="container">
            <div class="menu-tabs">
                <button class="tab-btn active" data-tab="all">All</button>
                <button class="tab-btn" data-tab="hot">Hot</button>
                <button class="tab-btn" data-tab="cold">Cold</button>
                <button class="tab-btn" data-tab="special">Special</button>
            </div>

            <!-- All -->
            <div class="menu-content active" id="all">
                <div class="menu-grid">
                    <!-- This will contain all items, to be populated via JavaScript -->
                </div>
            </div>

            <!-- Hot -->
            <div class="menu-content" id="hot">
                <div class="menu-grid">
                    <div class="menu-item" data-aos="fade-up" data-name="Barako" data-price="4.50" data-category="hot" data-img="../../Assets/Coffee/Hot Barako.webp">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Barako.webp" alt="Barako" class="menu-item-image">
                            <button class="favorite-btn" aria-label="Add to favorites">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Barako</h3>
                                <span class="price">$4.50</span>
                            </div>
                            <p>Strong and bold Filipino coffee with robust flavor</p>
                            <div class="menu-item-actions">
                                <button class="view-btn" title="View Details">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="add-to-cart-btn" title="Add to Cart">
                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="100" data-name="Cafe Mocha" data-price="5.50" data-category="hot" data-img="../../Assets/Coffee/Hot Cafe Mocha.webp">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Cafe Mocha.webp" alt="Cafe Mocha" class="menu-item-image">
                            <button class="favorite-btn" aria-label="Add to favorites">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cafe Mocha</h3>
                                <span class="price">$5.50</span>
                            </div>
                            <p>Rich chocolate and espresso with whipped cream</p>
                            <div class="menu-item-actions">
                                <button class="view-btn" title="View Details">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="add-to-cart-btn" title="Add to Cart">
                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="200">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot CaffÃ¨ Americano.webp" alt="CaffÃ¨ Americano" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>CaffÃ¨ Americano</h3>
                                <span class="price">$3.75</span>
                            </div>
                            <p>Rich espresso with hot water for a smooth finish</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="300">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Cappuccino.webp" alt="Cappuccino" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cappuccino</h3>
                                <span class="price">$4.50</span>
                            </div>
                            <p>Perfect balance of espresso, steamed milk, and foam</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Caramel Macchiato.webp" alt="Caramel Macchiato" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Caramel Macchiato</h3>
                                <span class="price">$5.75</span>
                            </div>
                            <p>Vanilla-flavored latte with caramel drizzle</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="100">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Dalgona Coffee.webp" alt="Dalgona Coffee" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Dalgona Coffee</h3>
                                <span class="price">$5.25</span>
                            </div>
                            <p>Whipped coffee foam over steamed milk</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="200">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Dirty Matcha Latte.webp" alt="Dirty Matcha Latte" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Dirty Matcha Latte</h3>
                                <span class="price">$5.75</span>
                            </div>
                            <p>Matcha green tea with a shot of espresso</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="300">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Flat white.webp" alt="Flat White" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Flat White</h3>
                                <span class="price">$4.75</span>
                            </div>
                            <p>Velvety microfoam with double ristretto espresso</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Spanish Latte.webp" alt="Spanish Latte" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Spanish Latte</h3>
                                <span class="price">$5.25</span>
                            </div>
                            <p>Espresso with sweetened condensed milk</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="100">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Hot Vanilla Latte.webp" alt="Vanilla Latte" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Vanilla Latte</h3>
                                <span class="price">$5.00</span>
                            </div>
                            <p>Smooth espresso with vanilla and steamed milk</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cold -->
            <div class="menu-content" id="cold">
                <div class="menu-grid">
                    <div class="menu-item" data-aos="fade-up">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Barako.webp" alt="Cold Barako" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Barako</h3>
                                <span class="price">$5.00</span>
                            </div>
                            <p>Iced Filipino coffee with intense flavor</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="100">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Cafe Mocha.webp" alt="Cold Cafe Mocha" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Cafe Mocha</h3>
                                <span class="price">$5.75</span>
                            </div>
                            <p>Iced chocolate espresso with cold milk</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="200">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold CaffÃ¨ Americano.webp" alt="Cold CaffÃ¨ Americano" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold CaffÃ¨ Americano</h3>
                                <span class="price">$4.00</span>
                            </div>
                            <p>Chilled espresso with cold water over ice</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="300">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Cappuccino.webp" alt="Cold Cappuccino" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Cappuccino</h3>
                                <span class="price">$4.75</span>
                            </div>
                            <p>Iced cappuccino with cold foam</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Caramel Macchiato.webp" alt="Cold Caramel Macchiato" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Caramel Macchiato</h3>
                                <span class="price">$6.00</span>
                            </div>
                            <p>Iced vanilla latte with caramel drizzle</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="100">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Dalgona Coffee.webp" alt="Cold Dalgona Coffee" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Dalgona Coffee</h3>
                                <span class="price">$5.50</span>
                            </div>
                            <p>Whipped coffee foam over cold milk and ice</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="200">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Dirty Matcha Latte.webp" alt="Cold Dirty Matcha Latte" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Dirty Matcha Latte</h3>
                                <span class="price">$6.00</span>
                            </div>
                            <p>Iced matcha with espresso shot</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="300">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Flat White.webp" alt="Cold Flat White" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Flat White</h3>
                                <span class="price">$5.00</span>
                            </div>
                            <p>Iced double ristretto with cold microfoam</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Spanish Latte.webp" alt="Cold Spanish Latte" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Spanish Latte</h3>
                                <span class="price">$5.50</span>
                            </div>
                            <p>Iced espresso with sweetened condensed milk</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="100">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Cold Vanilla Latte.webp" alt="Cold Vanilla Latte" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Cold Vanilla Latte</h3>
                                <span class="price">$5.25</span>
                            </div>
                            <p>Iced vanilla espresso with cold milk</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Special -->
            <div class="menu-content" id="special">
                <div class="menu-grid">
                    <div class="menu-item" data-aos="fade-up">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Special Affogato.webp" alt="Affogato" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Affogato</h3>
                                <span class="price">$6.00</span>
                            </div>
                            <p>Vanilla gelato drowned in hot espresso</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="100">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Special Greek Coffee Frappe.webp" alt="Greek Coffee Frappe" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Greek Coffee Frappe</h3>
                                <span class="price">$5.75</span>
                            </div>
                            <p>Frothy iced coffee with foam topping</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="200">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Special Java Chip Frappe.webp" alt="Java Chip Frappe" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Java Chip Frappe</h3>
                                <span class="price">$6.25</span>
                            </div>
                            <p>Blended coffee with chocolate chips and whipped cream</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up" data-delay="300">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Special Mocha Frappe.webp" alt="Mocha Frappe" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Mocha Frappe</h3>
                                <span class="price">$6.00</span>
                            </div>
                            <p>Blended mocha with ice and whipped topping</p>
                        </div>
                    </div>

                    <div class="menu-item" data-aos="fade-up">
                        <div class="menu-item-visual">
                            <img src="../../Assets/Coffee/Special Nitro Coffee.webp" alt="Nitro Coffee" class="menu-item-image">
                        </div>
                        <div class="menu-item-info">
                            <div class="menu-item-header">
                                <h3>Nitro Coffee</h3>
                                <span class="price">$6.50</span>
                            </div>
                            <p>Cold brew infused with nitrogen for a creamy texture</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <%- include('../partials/footer') %>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M12 19V5M5 12L12 5L19 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav" aria-label="Bottom Navigation">
        <a href="/" class="bn-link" aria-label="Home">
            <i class="fas fa-house" aria-hidden="true"></i>
            <span>Home</span>
        </a>
        <a href="/menu" class="bn-link" aria-label="Menu">
            <i class="fas fa-mug-saucer" aria-hidden="true"></i>
            <span>Menu</span>
        </a>
        <a href="/dashboard" class="bn-link" aria-label="Dashboard">
            <i class="fas fa-gauge" aria-hidden="true"></i>
            <span>Dashboard</span>
        </a>
        <a href="/cart" class="bn-link" aria-label="Cart">
            <i class="fas fa-cart-shopping" aria-hidden="true"></i>
            <span>Cart</span>
        </a>
        <a href="/specialties" class="bn-link" aria-label="Specialties">
            <i class="fas fa-star" aria-hidden="true"></i>
            <span>Specialties</span>
        </a>
    </nav>

    <!-- Image Preview Modal -->
    <div class="image-preview-overlay" id="imagePreviewOverlay">
        <div class="image-preview-modal">
            <button class="image-preview-close" id="closePreview" aria-label="Close preview">
                <i class="fas fa-times"></i>
            </button>
            <img src="" alt="Coffee preview" id="previewImage" class="preview-image">
        </div>
    </div>

    <script src="../js/shared.js"></script>
    <script>
        /* ===== MENU PAGE SCRIPT =====
         * Order of execution:
         * 1. Tab switching setup (immediately)
         * 2. Scroll animations setup (immediately)
         * 3. Auto-inject buttons into all menu items (immediately)
         * 4. Populate "All" tab with cloned items (immediately after injection)
         * 5. Load favorites and re-populate All tab (on window.load)
         * ============================= */
        
        // Tab switching functionality
        const tabBtns = document.querySelectorAll('.tab-btn');
        const menuContents = document.querySelectorAll('.menu-content');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetTab = btn.dataset.tab;
                
                // Remove active class from all buttons and contents
                tabBtns.forEach(b => b.classList.remove('active'));
                menuContents.forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                btn.classList.add('active');
                const targetContent = document.getElementById(targetTab);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
            });
        });

        // Scroll animations
        const observerOptions = {
            threshold: 0.2,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const delay = entry.target.getAttribute('data-delay') || 0;
                    setTimeout(() => {
                        entry.target.classList.add('animate-in');
                    }, parseInt(delay));
                }
            });
        }, observerOptions);

        document.querySelectorAll('[data-aos]').forEach(el => observer.observe(el));
        
        // Back to top functionality
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTopBtn = document.getElementById('backToTop');
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        });

        // Image preview functionality
        const previewOverlay = document.getElementById('imagePreviewOverlay');
        const previewImage = document.getElementById('previewImage');
        const closePreview = document.getElementById('closePreview');
        const menuImages = document.querySelectorAll('.menu-item-image');

        // Add click event to all menu images
        menuImages.forEach(img => {
            img.style.cursor = 'pointer';
            img.addEventListener('click', function() {
                previewImage.src = this.src;
                previewImage.alt = this.alt;
                previewOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
        });

        // Close preview on button click
        closePreview.addEventListener('click', function() {
            previewOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });

        // Close preview on overlay click
        previewOverlay.addEventListener('click', function(e) {
            if (e.target === previewOverlay) {
                previewOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Close preview on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && previewOverlay.classList.contains('active')) {
                previewOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Auto-inject buttons into all menu items that don't have them
        document.querySelectorAll('.menu-item').forEach(item => {
            const visual = item.querySelector('.menu-item-visual');
            const info = item.querySelector('.menu-item-info');
            const img = visual.querySelector('img');
            const h3 = info.querySelector('h3');
            const price = info.querySelector('.price');
            
            // Add data attributes if missing
            if (!item.dataset.name && h3) item.dataset.name = h3.textContent.trim();
            if (!item.dataset.price && price) item.dataset.price = price.textContent.replace('$', '').trim();
            if (!item.dataset.img && img) item.dataset.img = img.src;
            if (!item.dataset.category) {
                const tab = item.closest('[id]');
                item.dataset.category = tab ? tab.id : 'all';
            }

            // Add favorite button if not exists
            if (!visual.querySelector('.favorite-btn')) {
                const favBtn = document.createElement('button');
                favBtn.className = 'favorite-btn';
                favBtn.setAttribute('aria-label', 'Add to favorites');
                favBtn.innerHTML = '<i class="far fa-heart"></i>';
                visual.appendChild(favBtn);
            }

            // Add action buttons if not exists
            if (!info.querySelector('.menu-item-actions')) {
                const actions = document.createElement('div');
                actions.className = 'menu-item-actions';
                actions.innerHTML = `
                    <button class="view-btn" title="View Details">
                        <i class="fas fa-eye"></i> View
                    </button>
                    <button class="add-to-cart-btn" title="Add to Cart">
                        <i class="fas fa-cart-plus"></i> Add to Cart
                    </button>
                `;
                info.appendChild(actions);
            }
        });

        // Populate "All" tab with items from all categories (after buttons are injected)
        function populateAllTab() {
            const allGrid = document.querySelector('#all .menu-grid');
            const hotItems = document.querySelectorAll('#hot .menu-item');
            const coldItems = document.querySelectorAll('#cold .menu-item');
            const specialItems = document.querySelectorAll('#special .menu-item');
            
            console.log('Populating All tab...');
            console.log('Hot items:', hotItems.length);
            console.log('Cold items:', coldItems.length);
            console.log('Special items:', specialItems.length);
            console.log('All grid element:', allGrid);
            
            if (!allGrid) {
                console.error('All grid not found!');
                return;
            }
            
            // Clear any existing content
            allGrid.innerHTML = '';
            
            // Clone and append all items
            const allItems = [...hotItems, ...coldItems, ...specialItems];
            console.log('Total items to add:', allItems.length);
            
            allItems.forEach((item, index) => {
                const clone = item.cloneNode(true);
                allGrid.appendChild(clone);
                console.log('Added item', index + 1);
            });
            
            console.log('All tab populated with', allGrid.children.length, 'items');
        }

        // Call populate function after buttons are injected
        populateAllTab();

        // Favorite button functionality
        document.addEventListener('click', function(e) {
            if (e.target.closest('.favorite-btn')) {
                const btn = e.target.closest('.favorite-btn');
                const icon = btn.querySelector('i');
                const item = btn.closest('.menu-item');
                const itemName = item.dataset.name;
                
                if (icon.classList.contains('far')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    btn.classList.add('active');
                    
                    // Save to localStorage
                    let favorites = JSON.parse(localStorage.getItem('bb_favorites') || '[]');
                    if (!favorites.includes(itemName)) {
                        favorites.push(itemName);
                        localStorage.setItem('bb_favorites', JSON.stringify(favorites));
                    }
                    
                    showToast(`â¤ï¸ ${itemName} added to favorites!`);
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    btn.classList.remove('active');
                    
                    // Remove from localStorage
                    let favorites = JSON.parse(localStorage.getItem('bb_favorites') || '[]');
                    favorites = favorites.filter(f => f !== itemName);
                    localStorage.setItem('bb_favorites', JSON.stringify(favorites));
                    
                    showToast(`${itemName} removed from favorites`);
                }
            }
        });

        // Load favorites on page load
        window.addEventListener('load', function() {
            // Re-populate All tab to ensure it has all the buttons and data
            populateAllTab();
            
            // Apply favorite states
            const favorites = JSON.parse(localStorage.getItem('bb_favorites') || '[]');
            document.querySelectorAll('.menu-item').forEach(item => {
                if (favorites.includes(item.dataset.name)) {
                    const btn = item.querySelector('.favorite-btn');
                    if (btn) {
                        const icon = btn.querySelector('i');
                        if (icon) {
                            icon.classList.remove('far');
                            icon.classList.add('fas');
                            btn.classList.add('active');
                        }
                    }
                }
            });
        });

        // View button functionality
        document.addEventListener('click', function(e) {
            if (e.target.closest('.view-btn')) {
                const item = e.target.closest('.menu-item');
                const img = item.querySelector('.menu-item-image');
                if (img) {
                    previewImage.src = img.src;
                    previewImage.alt = img.alt;
                    previewOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }
        });

        // Add to Cart functionality
        document.addEventListener('click', function(e) {
            if (e.target.closest('.add-to-cart-btn')) {
                const btn = e.target.closest('.add-to-cart-btn');
                const item = btn.closest('.menu-item');
                
                const cartItem = {
                    id: item.dataset.name.toLowerCase().replace(/\s+/g, '-'),
                    name: item.dataset.name,
                    note: item.dataset.category.charAt(0).toUpperCase() + item.dataset.category.slice(1),
                    price: parseFloat(item.dataset.price),
                    qty: 1,
                    selected: true,
                    img: item.dataset.img
                };

                // Load existing cart
                let cart = JSON.parse(localStorage.getItem('bb_cart_items') || '[]');
                
                // Check if item already exists
                const existingIndex = cart.findIndex(c => c.id === cartItem.id);
                if (existingIndex >= 0) {
                    cart[existingIndex].qty += 1;
                    showToast(`ðŸ“¦ ${cartItem.name} quantity updated in cart!`);
                } else {
                    cart.push(cartItem);
                    showToast(`âœ… ${cartItem.name} added to cart!`);
                }
                
                // Save cart
                localStorage.setItem('bb_cart_items', JSON.stringify(cart));
                
                // Visual feedback
                btn.innerHTML = '<i class="fas fa-check"></i> Added!';
                btn.style.background = 'linear-gradient(135deg, #2e7d32, #1b5e20)';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
                    btn.style.background = '';
                }, 2000);
            }
        });

        // Toast notification
        function showToast(message) {
            const existingToast = document.querySelector('.toast-notification');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>