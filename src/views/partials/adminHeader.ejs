<!-- Admin Header Partial -->
    <link rel="stylesheet" href="/css/adminHeaderSidebar.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

<header class="header">
    <button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle sidebar">
        <i class="fas fa-bars"></i>
    </button>
    <div class="header-actions">
        <button class="notification-btn">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
        </button>

        <!-- Profile dropdown (replaces standalone logout button) -->
        <div class="profile-dropdown" style="position: relative;">
            <button id="profileBtn" class="profile-btn" aria-haspopup="true" aria-expanded="false" style="display:flex;align-items:center;gap:8px;background:none;border:none;cursor:pointer;touch-action:manipulation;">
                <div class="user-avatar"><%= (admin && admin.email) ? admin.email.charAt(0).toUpperCase() : 'A' %></div>
                <div class="user-info">
                    <span class="user-name"><%= admin?.email || 'Admin' %></span>
                </div>
                <i class="fas fa-chevron-down user-dropdown-icon"></i>
            </button>

            <div id="profileMenu" class="profile-menu" style="position:absolute;right:0;top:calc(100% + 8px);background:white;border:1px solid #eee;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);display:none;min-width:160px;z-index:2000;">
                <a href="#" id="adminLogout" style="display:block;padding:10px 14px;color:#333;text-decoration:none;border-bottom:1px solid #f5f5f5;">Logout</a>
            </div>
        </div>
    </div>

    <script>
    (function(){
        const profileBtn = document.getElementById('profileBtn');
        const profileMenu = document.getElementById('profileMenu');
        const adminLogout = document.getElementById('adminLogout');

        function closeProfileMenu() {
            if (profileMenu) {
                profileMenu.style.display = 'none';
            }
            if (profileBtn) {
                profileBtn.setAttribute('aria-expanded', 'false');
            }
        }

        if (profileBtn && profileMenu) {
            profileBtn.addEventListener('click', function(e){
                e.preventDefault();
                e.stopPropagation();
                const isOpen = profileMenu.style.display === 'block';
                profileMenu.style.display = isOpen ? 'none' : 'block';
                profileBtn.setAttribute('aria-expanded', String(!isOpen));
            });

            // Consolidated click handler - close profile menu when clicking outside OR sidebar toggle
            document.addEventListener('click', function(ev){
                const sidebarToggle = document.getElementById('sidebarToggle');
                
                // Check if clicked sidebar toggle
                if (sidebarToggle && sidebarToggle.contains(ev.target)) {
                    closeProfileMenu();
                    return;
                }
                
                // Check if clicked outside profile menu
                if (!profileBtn.contains(ev.target) && !profileMenu.contains(ev.target)) {
                    closeProfileMenu();
                }
            });

            // Close profile menu when a modal opens
            document.addEventListener('show.bs.modal', closeProfileMenu);
        }

        if (adminLogout) {
            adminLogout.addEventListener('click', async function(e){
                e.preventDefault();
                try {
                    // POST to admin logout route to clear httpOnly cookie
                    const resp = await fetch('/admin/logout', { method: 'POST', credentials: 'same-origin' });
                    // Redirect to home after logout
                    window.location.href = '/';
                } catch (err) {
                    console.error('Admin logout failed', err);
                    window.location.href = '/';
                }
            });
        }
    })();
    </script>
    <script src="/js/admin/adminHeader.js"></script>
</header>
